groups:
  - name: "Container Image"
    description: "Image to be used for container"
  - name: "Workload Configuration"
    description: "Configure workload deployment"
  - name: "Configuration"
    description: "additional container configuration"
  - name: "Networking"
    description: "Configure / service for container"
  - name: "Storage and Devices"
    description: "Persist and share data that is separate from the lifecycle of the container"
  - name: "Resource Reservation"
    description: "Specify resources to be allocated to workload"
  - name: "Reverse Proxy Configuration"
    description: "Reverse Proxy configuration"
  - name: "Advanced"
    description: "Advanced Configuration"

questions:

## Update Policy
  - variable: strategyType
    group: "Container Image"
    label: "Update Strategy"
    schema:
      type: string
      default: "Recreate"
      enum:
        - value: "RollingUpdate"
          description: "Create new pods and then kill old ones"
        - value: "Recreate"
          description: "Kill existing pods before creating new ones"

## Configure Time Zone
  - variable: timezone
    group: "Container Image"
    label: "Timezone"
    schema:
      type: string
      default: "Australia/Hobart"
      $ref:
        - "definitions/timezone"

  - variable: PUID
    group: "Container Image"
    label: "PUID"
    description: "The UserID of the user running the application and owning the files"
    schema:
      type: int
      default: 568

  - variable: PGID
    group: "Container Image"
    label: "PGID"
    description: "The groupID of the user/group running the application and owning the files"
    schema:
      type: int
      default: 568

  - variable: UMASK
    group: "Container Image"
    label: "UMASK (advanced)"
    description: "The UMASK used if supported by the application"
    schema:
      type: string
      default: "002"



## Configure Enviroment Variables
  - variable: environmentVariables
    label: "Image environment"
    group: "Configuration"
    schema:
      type: list
      default: []
      items:
        - variable: environmentVariable
          label: "Environment Variable"
          schema:
            type: dict
            attrs:
              - variable: name
                label: "Name"
                schema:
                  type: string
              - variable: value
                label: "Value"
                schema:
                  type: string

  - variable: mqtt_url
    group: "Container Image"
    label: "MQTT Broker URL"
    description: "The URL (on port 1883) of the MQTT Broker"
    schema:
      type: string
      default: "mosquitto.ix-mosquitto.svc.cluster.local"

## Enable Host Network
  - variable: hostNetwork
    group: "Networking"
    label: "Enable Host Network"
    schema:
      type: boolean
      default: false

## Volumes
  - variable: appVolumeMounts
    label: "app storage"
    group: "Storage and Devices"
    schema:
      type: dict
      attrs:
        - variable: data
          label: "data dataset"
          schema:
            type: dict
            $ref:
              - "normalize/ixVolume"
            attrs:
              - variable: enabled
                label: "Enabled"
                schema:
                  type: boolean
                  default: true
                  required: true
                  hidden: true
                  editable: false
              - variable: setPermissions
                label: "Automatic Permissions"
                description: "Automatically set permissions on install"
                schema:
                  type: boolean
                  default: true
                  hidden: false
              - variable: emptyDir
                label: "emptyDir"
                schema:
                  type: boolean
                  default: false
                  hidden: true
                  editable: false
              - variable: datasetName
                label: "Dataset Name"
                schema:
                  type: string
                  default: "data"
                  required: true
                  editable: false
              - variable: mountPath
                label: "Mount Path"
                description: "Path to mount inside the pod"
                schema:
                  type: path
                  required: true
                  default: "/data"
                  editable: false
              - variable: hostPathEnabled
                label: "host Path Enabled"
                schema:
                  type: boolean
                  default: false
                  show_subquestions_if: true
                  subquestions:
                    - variable: hostPath
                      label: "Host Path"
                      schema:
                        type: hostpath
                        required: true
        - variable: hub
          label: "Rollease V1 Hub Serial Device"
          schema:
            type: dict
            attrs:
              - variable: hostPathEnabled
                label: "Enable Host Path"
                schema:
                  type: boolean
                  default: true
                  hidden: true
              - variable: setPermissions
                label: "Automatic Permissions"
                schema:
                  type: boolean
                  default: false
                  hidden: true
              - variable: emptyDir
                label: "Empty Dir"
                schema:
                  type: boolean
                  default: false
                  hidden: true
              - variable: mountPath
                label: "Path to mount hub inside the container"
                schema:
                  type: path
                  default: "/dev/ttyACM0"
                  required: true
                  editable: false
              - variable: hostPath
                label: "Path to hub device on host"
                schema:
                  type: path
                  default: "/dev/ttyACM0"
                  required: true

  # Enable privileged
  - variable: securityContext
    group: "Storage and Devices"
    label: "Security Context"
    schema:
      type: dict
      attrs:
        - variable: privileged
          label: "Enable privileged to pass thru a USB device"
          schema:
            type: boolean
            default: true
            required: true